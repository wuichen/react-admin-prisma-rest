# Migration `20200527174145-init`

This migration has been generated by I Chen Wu at 5/27/2020, 5:41:45 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Address" (
"companyId" integer   ,"id" SERIAL,"info" text  NOT NULL ,"json" text   ,"name" text  NOT NULL ,"type" text  NOT NULL ,"userId" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Card" (
"cardType" text  NOT NULL ,"id" SERIAL,"lastFourDigit" integer  NOT NULL ,"name" text  NOT NULL ,"type" text  NOT NULL ,"userId" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Contact" (
"companyId" integer   ,"id" SERIAL,"number" text  NOT NULL ,"type" text  NOT NULL ,"userId" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Company" (
"addressId" integer  NOT NULL ,"contactId" integer  NOT NULL ,"description" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,"ownerId" integer   ,"platformId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Country" (
"code" integer  NOT NULL ,"currency" text  NOT NULL ,"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Platform" (
"bannerImg" text   ,"countryId" integer   ,"description" text   ,"id" SERIAL,"name" text   ,"ownerId" integer  NOT NULL ,"platformType" text   ,"slug" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"coverImage" text   ,"coverImagePublicId" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"googleId" text   ,"id" SERIAL,"image" text   ,"imagePublicId" text   ,"income" Decimal(65,30)   ,"isOnline" boolean  NOT NULL DEFAULT false,"name" text   ,"password" text  NOT NULL ,"passwordResetToken" text   ,"passwordResetTokenExpiry" timestamp(3)   ,"token" text   ,"username" text   ,"walletId" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Customers" (
"address" text   ,"avatar" text   ,"birthday" timestamp(3)   ,"city" text   ,"companyId" integer   ,"email" text  NOT NULL ,"first_name" text  NOT NULL ,"first_seen" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"groups" text []  ,"has_newsletter" boolean   DEFAULT false,"has_ordered" boolean   DEFAULT false,"id" SERIAL,"last_name" text  NOT NULL ,"last_seen" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"latest_purchase" timestamp(3)   ,"nb_commands" integer   ,"total_spent" Decimal(65,30)   DEFAULT 0,"zipcode" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Categories" (
"id" SERIAL,"name" text  NOT NULL ,"platformId" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Products" (
"category_id" integer   ,"companyId" integer   ,"description" text   ,"height" Decimal(65,30)   ,"id" SERIAL,"image" text   ,"price" Decimal(65,30)   ,"reference" text   ,"stock" integer   ,"thumbnail" text   ,"width" Decimal(65,30)   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Baskets" (
"command_id" integer  NOT NULL ,"id" SERIAL,"product_id" integer  NOT NULL ,"quantity" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Commands" (
"companyId" integer   ,"customer_id" integer   ,"date" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"delivery_fees" Decimal(65,30)   ,"id" SERIAL,"reference" text   ,"returned" boolean   ,"status" text   ,"tax_rate" Decimal(65,30)   ,"taxes" Decimal(65,30)   ,"total" Decimal(65,30)   ,"total_ex_taxes" Decimal(65,30)   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Invoices" (
"command_id" integer   ,"companyId" integer   ,"customer_id" integer   ,"date" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"delivery_fees" Decimal(65,30)   ,"id" SERIAL,"tax_rate" Decimal(65,30)   ,"taxes" Decimal(65,30)   ,"total" Decimal(65,30)   ,"total_ex_taxes" Decimal(65,30)   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Reviews" (
"command_id" integer   ,"comment" text   ,"companyId" integer   ,"customer_id" integer   ,"date" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"product_id" integer   ,"rating" integer   ,"status" text   ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "Company_addressId" ON "public"."Company"("addressId")

CREATE UNIQUE INDEX "Company_contactId" ON "public"."Company"("contactId")

CREATE UNIQUE INDEX "Country.code" ON "public"."Country"("code")

CREATE UNIQUE INDEX "Platform.slug" ON "public"."Platform"("slug")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Card" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("addressId")REFERENCES "public"."Address"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("contactId")REFERENCES "public"."Contact"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("platformId")REFERENCES "public"."Platform"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Company" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Platform" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Platform" ADD FOREIGN KEY ("countryId")REFERENCES "public"."Country"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Customers" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Categories" ADD FOREIGN KEY ("platformId")REFERENCES "public"."Platform"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Products" ADD FOREIGN KEY ("category_id")REFERENCES "public"."Categories"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Products" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Baskets" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Baskets" ADD FOREIGN KEY ("product_id")REFERENCES "public"."Products"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Commands" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Commands" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("product_id")REFERENCES "public"."Products"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("companyId")REFERENCES "public"."Company"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200527174145-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,219 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("PRISMA_POSTGRES_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Address {
+  id        Int      @default(autoincrement()) @id
+  type      String
+  name      String
+  json      String?
+  info      String
+  companyId Int?
+  company   Company?
+  userId    Int?
+  user      User?    @relation(fields: [userId], references: [id])
+}
+
+model Card {
+  id            Int    @default(autoincrement()) @id
+  type          String
+  cardType      String
+  name          String
+  lastFourDigit Int
+  userId        Int?
+  user          User?  @relation(fields: [userId], references: [id])
+}
+
+model Contact {
+  id        Int      @default(autoincrement()) @id
+  type      String
+  number    String
+  companyId Int?
+  company   Company?
+  userId    Int?
+  user      User?    @relation(fields: [userId], references: [id])
+}
+
+model Company {
+  id          Int         @default(autoincrement()) @id
+  name        String
+  description String
+  address     Address     @relation(fields: [addressId], references: [id])
+  addressId   Int
+  contact     Contact     @relation(fields: [contactId], references: [id])
+  contactId   Int
+  platformId  Int
+  platform    Platform    @relation(fields: [platformId], references: [id])
+  products    Products[]
+  customers   Customers[]
+  orders      Commands[]
+  owner       User?       @relation(fields: [ownerId], references: [id])
+  ownerId     Int?
+  invoices    Invoices[]
+  reviews     Reviews[]
+}
+
+model Country {
+  id        Int        @default(autoincrement()) @id
+  code      Int        @unique
+  name      String
+  currency  String
+  platforms Platform[]
+}
+
+model Platform {
+  id           Int          @default(autoincrement()) @id
+  name         String?
+  bannerImg    String?
+  slug         String?      @unique
+  ownerId      Int
+  owner        User         @relation(fields: [ownerId], references: [id])
+  description  String?
+  companies    Company[]
+  categories   Categories[]
+  platformType String?
+  countryId    Int?
+  country      Country?     @relation(fields: [countryId], references: [id])
+}
+
+model User {
+  id                       Int        @default(autoincrement()) @id
+  createdAt                DateTime   @default(now())
+  email                    String     @unique
+  name                     String?
+  password                 String
+  token                    String?
+  googleId                 String?
+  walletId                 String?
+  income                   Float?
+  username                 String?
+  passwordResetToken       String?
+  passwordResetTokenExpiry DateTime?
+  image                    String?
+  imagePublicId            String?
+  coverImage               String?
+  coverImagePublicId       String?
+  isOnline                 Boolean    @default(false)
+  companies                Company[]
+  platforms                Platform[]
+  addresses                Address[]
+  cards                    Card[]
+  contacts                 Contact[]
+}
+
+model Customers {
+  id              Int        @default(autoincrement()) @id
+  first_name      String
+  last_name       String
+  email           String
+  address         String?
+  zipcode         String?
+  city            String?
+  avatar          String?
+  birthday        DateTime?
+  first_seen      DateTime?  @default(now())
+  last_seen       DateTime?  @default(now())
+  has_ordered     Boolean?   @default(false)
+  latest_purchase DateTime?
+  has_newsletter  Boolean?   @default(false)
+  groups          String[]
+  nb_commands     Int?
+  total_spent     Float?     @default(0)
+  reviews         Reviews[]
+  invoices        Invoices[]
+  commands        Commands[]
+  company         Company?   @relation(fields: [companyId], references: [id])
+  companyId       Int?
+}
+
+model Categories {
+  id         Int        @default(autoincrement()) @id
+  name       String
+  products   Products[]
+  Platform   Platform?  @relation(fields: [platformId], references: [id])
+  platformId Int?
+}
+
+model Products {
+  id          Int         @default(autoincrement()) @id
+  category    Categories? @relation(fields: [category_id], references: [id])
+  category_id Int?
+  reference   String?
+  width       Float?
+  height      Float?
+  price       Float?
+  thumbnail   String?
+  image       String?
+  description String?
+  stock       Int?
+  review      Reviews[]
+  basket      Baskets[]
+  company     Company?    @relation(fields: [companyId], references: [id])
+  companyId   Int?
+}
+
+model Baskets {
+  id         Int      @default(autoincrement()) @id
+  command    Commands @relation(fields: [command_id], references: [id])
+  command_id Int
+  product_id Int
+  quantity   Int
+  product    Products @relation(fields: [product_id], references: [id])
+}
+
+model Commands {
+  id             Int        @default(autoincrement()) @id
+  reference      String?
+  date           DateTime?  @default(now())
+  customer_id    Int?
+  customer       Customers? @relation(fields: [customer_id], references: [id])
+  total_ex_taxes Float?
+  delivery_fees  Float?
+  tax_rate       Float?
+  taxes          Float?
+  total          Float?
+  status         String?
+  returned       Boolean?
+  invoice        Invoices[]
+  review         Reviews[]
+  basket         Baskets[]
+  company        Company?   @relation(fields: [companyId], references: [id])
+  companyId      Int?
+}
+
+model Invoices {
+  id             Int        @default(autoincrement()) @id
+  date           DateTime?  @default(now())
+  command_id     Int?
+  command        Commands?  @relation(fields: [command_id], references: [id])
+  customer_id    Int?
+  customer       Customers? @relation(fields: [customer_id], references: [id])
+  total_ex_taxes Float?
+  delivery_fees  Float?
+  tax_rate       Float?
+  taxes          Float?
+  total          Float?
+  company        Company?   @relation(fields: [companyId], references: [id])
+  companyId      Int?
+}
+
+model Reviews {
+  id          Int        @default(autoincrement()) @id
+  date        DateTime?  @default(now())
+  status      String?
+  command_id  Int?
+  command     Commands?  @relation(fields: [command_id], references: [id])
+  product_id  Int?
+  product     Products?  @relation(fields: [product_id], references: [id])
+  customer_id Int?
+  customer    Customers? @relation(fields: [customer_id], references: [id])
+  rating      Int?
+  comment     String?
+  company     Company?   @relation(fields: [companyId], references: [id])
+  companyId   Int?
+}
```


