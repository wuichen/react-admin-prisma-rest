# Migration `20200526130518-init`

This migration has been generated by I Chen Wu at 5/26/2020, 1:05:18 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Commands" DROP CONSTRAINT IF EXiSTS "Commands_customer_id_fkey",
ALTER COLUMN "basket" DROP NOT NULL,
ALTER COLUMN "customer_id" DROP NOT NULL,
ALTER COLUMN "date" DROP NOT NULL,
ALTER COLUMN "date" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "delivery_fees" DROP NOT NULL,
ALTER COLUMN "reference" DROP NOT NULL,
ALTER COLUMN "returned" DROP NOT NULL,
ALTER COLUMN "status" DROP NOT NULL,
ALTER COLUMN "tax_rate" DROP NOT NULL,
ALTER COLUMN "taxes" DROP NOT NULL,
ALTER COLUMN "total" DROP NOT NULL,
ALTER COLUMN "total_ex_taxes" DROP NOT NULL;

ALTER TABLE "public"."Customers" ALTER COLUMN "address" DROP NOT NULL,
ALTER COLUMN "avatar" DROP NOT NULL,
ALTER COLUMN "birthday" DROP NOT NULL,
ALTER COLUMN "city" DROP NOT NULL,
ALTER COLUMN "first_seen" DROP NOT NULL,
ALTER COLUMN "first_seen" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "has_newsetter" DROP NOT NULL,
ALTER COLUMN "has_newsetter" SET DEFAULT false,
ALTER COLUMN "has_ordered" DROP NOT NULL,
ALTER COLUMN "has_ordered" SET DEFAULT false,
ALTER COLUMN "last_seen" DROP NOT NULL,
ALTER COLUMN "last_seen" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "latest_purchase" DROP NOT NULL,
ALTER COLUMN "nb_commands" DROP NOT NULL,
ALTER COLUMN "total_spent" DROP NOT NULL,
ALTER COLUMN "total_spent" SET DEFAULT 0,
ALTER COLUMN "zipcode" DROP NOT NULL;

ALTER TABLE "public"."Invoices" DROP CONSTRAINT IF EXiSTS "Invoices_command_id_fkey",
DROP CONSTRAINT IF EXiSTS "Invoices_customer_id_fkey",
ALTER COLUMN "command_id" DROP NOT NULL,
ALTER COLUMN "customer_id" DROP NOT NULL,
ALTER COLUMN "date" DROP NOT NULL,
ALTER COLUMN "date" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "delivery_fees" DROP NOT NULL,
ALTER COLUMN "tax_rate" DROP NOT NULL,
ALTER COLUMN "taxes" DROP NOT NULL,
ALTER COLUMN "total" DROP NOT NULL,
ALTER COLUMN "total_ex_taxes" DROP NOT NULL;

ALTER TABLE "public"."Products" ALTER COLUMN "description" DROP NOT NULL,
ALTER COLUMN "height" DROP NOT NULL,
ALTER COLUMN "image" DROP NOT NULL,
ALTER COLUMN "price" DROP NOT NULL,
ALTER COLUMN "reference" DROP NOT NULL,
ALTER COLUMN "stock" DROP NOT NULL,
ALTER COLUMN "thumbnail" DROP NOT NULL,
ALTER COLUMN "width" DROP NOT NULL;

ALTER TABLE "public"."Reviews" DROP CONSTRAINT IF EXiSTS "Reviews_command_id_fkey",
DROP CONSTRAINT IF EXiSTS "Reviews_customer_id_fkey",
DROP CONSTRAINT IF EXiSTS "Reviews_product_id_fkey",
ALTER COLUMN "command_id" DROP NOT NULL,
ALTER COLUMN "comment" DROP NOT NULL,
ALTER COLUMN "customer_id" DROP NOT NULL,
ALTER COLUMN "date" DROP NOT NULL,
ALTER COLUMN "date" SET DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "product_id" DROP NOT NULL,
ALTER COLUMN "rating" DROP NOT NULL,
ALTER COLUMN "status" DROP NOT NULL;

ALTER TABLE "public"."Commands" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("product_id")REFERENCES "public"."Products"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200526121935-ini..20200526130518-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("PRISMA_POSTGRES_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -11,21 +11,21 @@
   id              Int        @default(autoincrement()) @id
   first_name      String
   last_name       String
   email           String
-  address         String
-  zipcode         String
-  city            String
-  avatar          String
-  birthday        DateTime
-  first_seen      DateTime
-  last_seen       DateTime
-  has_ordered     Boolean
-  latest_purchase String
-  has_newsetter   Boolean
+  address         String?
+  zipcode         String?
+  city            String?
+  avatar          String?
+  birthday        DateTime?
+  first_seen      DateTime?  @default(now())
+  last_seen       DateTime?  @default(now())
+  has_ordered     Boolean?   @default(false)
+  latest_purchase String?
+  has_newsetter   Boolean?   @default(false)
   groups          String[]
-  nb_commands     Int
-  total_spent     Int
+  nb_commands     Int?
+  total_spent     Int?       @default(0)
   Review          Reviews[]
   Invoice         Invoices[]
   Command         Commands[]
 }
@@ -39,60 +39,60 @@
 model Products {
   id          Int         @default(autoincrement()) @id
   category    Categories? @relation(fields: [category_id], references: [id])
   category_id Int?
-  reference   String
-  width       Float
-  height      Float
-  price       Float
-  thumbnail   String
-  image       String
-  description String
-  stock       Int
+  reference   String?
+  width       Float?
+  height      Float?
+  price       Float?
+  thumbnail   String?
+  image       String?
+  description String?
+  stock       Int?
   Review      Reviews[]
 }
 model Commands {
   id             Int        @default(autoincrement()) @id
-  reference      String
-  date           DateTime
-  customer_id    Int
-  customer       Customers  @relation(fields: [customer_id], references: [id])
-  basket         Json
-  total_ex_taxes Float
-  delivery_fees  Float
-  tax_rate       Float
-  taxes          Float
-  total          Float
-  status         String
-  returned       Boolean
+  reference      String?
+  date           DateTime?  @default(now())
+  customer_id    Int?
+  customer       Customers? @relation(fields: [customer_id], references: [id])
+  basket         Json?
+  total_ex_taxes Float?
+  delivery_fees  Float?
+  tax_rate       Float?
+  taxes          Float?
+  total          Float?
+  status         String?
+  returned       Boolean?
   Invoice        Invoices[]
   Review         Reviews[]
 }
 model Invoices {
-  id             Int       @default(autoincrement()) @id
-  date           DateTime
-  command_id     Int
-  command        Commands  @relation(fields: [command_id], references: [id])
-  customer_id    Int
-  customer       Customers @relation(fields: [customer_id], references: [id])
-  total_ex_taxes Float
-  delivery_fees  Float
-  tax_rate       Float
-  taxes          Float
-  total          Float
+  id             Int        @default(autoincrement()) @id
+  date           DateTime?  @default(now())
+  command_id     Int?
+  command        Commands?  @relation(fields: [command_id], references: [id])
+  customer_id    Int?
+  customer       Customers? @relation(fields: [customer_id], references: [id])
+  total_ex_taxes Float?
+  delivery_fees  Float?
+  tax_rate       Float?
+  taxes          Float?
+  total          Float?
 }
 model Reviews {
-  id          Int       @default(autoincrement()) @id
-  date        DateTime
-  status      String
-  command_id  Int
-  command     Commands  @relation(fields: [command_id], references: [id])
-  product_id  Int
-  product     Products  @relation(fields: [product_id], references: [id])
-  customer_id Int
-  customer    Customers @relation(fields: [customer_id], references: [id])
-  rating      Int
-  comment     String
+  id          Int        @default(autoincrement()) @id
+  date        DateTime?  @default(now())
+  status      String?
+  command_id  Int?
+  command     Commands?  @relation(fields: [command_id], references: [id])
+  product_id  Int?
+  product     Products?  @relation(fields: [product_id], references: [id])
+  customer_id Int?
+  customer    Customers? @relation(fields: [customer_id], references: [id])
+  rating      Int?
+  comment     String?
 }
```


