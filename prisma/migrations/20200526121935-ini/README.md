# Migration `20200526121935-ini`

This migration has been generated by I Chen Wu at 5/26/2020, 12:19:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Customers" (
"address" text  NOT NULL ,"avatar" text  NOT NULL ,"birthday" timestamp(3)  NOT NULL ,"city" text  NOT NULL ,"email" text  NOT NULL ,"first_name" text  NOT NULL ,"first_seen" timestamp(3)  NOT NULL ,"groups" text []  ,"has_newsetter" boolean  NOT NULL ,"has_ordered" boolean  NOT NULL ,"id" SERIAL,"last_name" text  NOT NULL ,"last_seen" timestamp(3)  NOT NULL ,"latest_purchase" text  NOT NULL ,"nb_commands" integer  NOT NULL ,"total_spent" integer  NOT NULL ,"zipcode" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Categories" (
"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Products" (
"category_id" integer   ,"description" text  NOT NULL ,"height" Decimal(65,30)  NOT NULL ,"id" SERIAL,"image" text  NOT NULL ,"price" Decimal(65,30)  NOT NULL ,"reference" text  NOT NULL ,"stock" integer  NOT NULL ,"thumbnail" text  NOT NULL ,"width" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Commands" (
"basket" jsonb  NOT NULL ,"customer_id" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"delivery_fees" Decimal(65,30)  NOT NULL ,"id" SERIAL,"reference" text  NOT NULL ,"returned" boolean  NOT NULL ,"status" text  NOT NULL ,"tax_rate" Decimal(65,30)  NOT NULL ,"taxes" Decimal(65,30)  NOT NULL ,"total" Decimal(65,30)  NOT NULL ,"total_ex_taxes" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Invoices" (
"command_id" integer  NOT NULL ,"customer_id" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"delivery_fees" Decimal(65,30)  NOT NULL ,"id" SERIAL,"tax_rate" Decimal(65,30)  NOT NULL ,"taxes" Decimal(65,30)  NOT NULL ,"total" Decimal(65,30)  NOT NULL ,"total_ex_taxes" Decimal(65,30)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Reviews" (
"command_id" integer  NOT NULL ,"comment" text  NOT NULL ,"customer_id" integer  NOT NULL ,"date" timestamp(3)  NOT NULL ,"id" SERIAL,"product_id" integer  NOT NULL ,"rating" integer  NOT NULL ,"status" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Products" ADD FOREIGN KEY ("category_id")REFERENCES "public"."Categories"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Commands" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Invoices" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("command_id")REFERENCES "public"."Commands"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("product_id")REFERENCES "public"."Products"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Reviews" ADD FOREIGN KEY ("customer_id")REFERENCES "public"."Customers"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200526121935-ini
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("PRISMA_POSTGRES_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Customers {
+  id              Int        @default(autoincrement()) @id
+  first_name      String
+  last_name       String
+  email           String
+  address         String
+  zipcode         String
+  city            String
+  avatar          String
+  birthday        DateTime
+  first_seen      DateTime
+  last_seen       DateTime
+  has_ordered     Boolean
+  latest_purchase String
+  has_newsetter   Boolean
+  groups          String[]
+  nb_commands     Int
+  total_spent     Int
+  Review          Reviews[]
+  Invoice         Invoices[]
+  Command         Commands[]
+}
+
+model Categories {
+  id      Int        @default(autoincrement()) @id
+  name    String
+  Product Products[]
+}
+
+model Products {
+  id          Int         @default(autoincrement()) @id
+  category    Categories? @relation(fields: [category_id], references: [id])
+  category_id Int?
+  reference   String
+  width       Float
+  height      Float
+  price       Float
+  thumbnail   String
+  image       String
+  description String
+  stock       Int
+  Review      Reviews[]
+}
+
+model Commands {
+  id             Int        @default(autoincrement()) @id
+  reference      String
+  date           DateTime
+  customer_id    Int
+  customer       Customers  @relation(fields: [customer_id], references: [id])
+  basket         Json
+  total_ex_taxes Float
+  delivery_fees  Float
+  tax_rate       Float
+  taxes          Float
+  total          Float
+  status         String
+  returned       Boolean
+  Invoice        Invoices[]
+  Review         Reviews[]
+}
+
+model Invoices {
+  id             Int       @default(autoincrement()) @id
+  date           DateTime
+  command_id     Int
+  command        Commands  @relation(fields: [command_id], references: [id])
+  customer_id    Int
+  customer       Customers @relation(fields: [customer_id], references: [id])
+  total_ex_taxes Float
+  delivery_fees  Float
+  tax_rate       Float
+  taxes          Float
+  total          Float
+}
+
+model Reviews {
+  id          Int       @default(autoincrement()) @id
+  date        DateTime
+  status      String
+  command_id  Int
+  command     Commands  @relation(fields: [command_id], references: [id])
+  product_id  Int
+  product     Products  @relation(fields: [product_id], references: [id])
+  customer_id Int
+  customer    Customers @relation(fields: [customer_id], references: [id])
+  rating      Int
+  comment     String
+}
```


